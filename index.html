<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Daily Cash Voice â†’ n8n</title>
  <style>body{font-family:sans-serif;padding:12px;}button{padding:10px 14px;font-size:16px}</style>
</head>
<body>
  <h2>Speak your daily cash report</h2>
  <p>Press <strong>Start</strong>, speak clearly (e.g. "Today I received 5000 and paid 1200 for groceries"), then press <strong>Stop</strong>.</p>

  <button id="start">Start</button>
  <button id="stop" disabled>Stop</button>
  <p><strong>Transcript:</strong> <span id="transcript">(none)</span></p>
  <pre id="items"></pre>

  <script>
  // ---- CONFIG: paste your n8n webhook URL here (replace the example) ----
  const N8N_WEBHOOK = 'https://defprojectzone.app.n8n.cloud/webhook-test/6869ed95-5352-4697-a230-4053a964e739';
  // ----------------------------------------------------------------------

  const startBtn = document.getElementById('start');
  const stopBtn = document.getElementById('stop');
  const transcriptEl = document.getElementById('transcript');
  const itemsEl = document.getElementById('items');

  let recognition;
  if (window.SpeechRecognition || window.webkitSpeechRecognition) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
  } else {
    alert('Speech recognition not supported in this browser. Use Chrome on Android or Chrome/Edge on desktop.');
  }

  startBtn.onclick = () => {
    itemsEl.textContent = '';
    transcriptEl.textContent = 'Listening...';
    recognition.start();
    startBtn.disabled = true; stopBtn.disabled = false;
  };
  stopBtn.onclick = () => {
    recognition.stop();
    startBtn.disabled = false; stopBtn.disabled = true;
  };

  function findAmounts(text) {
    const amountRegex = /\b\d+[\d,.]*\b/g;
    const matches = text.match(amountRegex) || [];
    return matches.map(m => Number(m.replace(/,/g,''))).filter(n => !Number.isNaN(n));
  }

  recognition.onresult = (event) => {
    const text = event.results[0][0].transcript;
    transcriptEl.textContent = text;
    const amounts = findAmounts(text);
    itemsEl.textContent = JSON.stringify({text, amounts}, null, 2);

    // send POST to n8n
    fetch(N8N_WEBHOOK, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({transcript: text, amounts})
    }).then(r => {
      if (r.ok) alert('Sent to workflow'); else alert('Send failed: '+r.status);
    }).catch(err => alert('Network send error: '+err));
  };

  recognition.onerror = (ev) => {
    transcriptEl.textContent = 'Error: ' + (ev.error || 'unknown');
    startBtn.disabled = false; stopBtn.disabled = true;
  };
  </script>
</body>
</html>
